<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Expense Tracker — Styled</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg-1: linear-gradient(135deg,#fdfdfd 0%, #f4f9ff 50%, #ffffff 100%);
      --card: #ffffff;
      --accent: #22c55e; /* green */
      --accent-2: #3b82f6; /* blue */
      --accent-3: #f59e0b; /* amber */
      --muted: #374151;
      --border: #e5e7eb;
      --radius: 14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      font-family: Inter, Poppins, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: var(--bg-1);
      color:var(--muted);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }

    .container{width:100%; max-width:1200px; margin:0 auto;}

    header{display:flex; align-items:center; justify-content:space-between; gap:20px; margin-bottom:18px;}

    h2{margin:0; font-weight:700; letter-spacing:-0.4px; color:#111827; font-size:22px;}
    .subtle{font-size:13px; color:#6b7280;}

    .card{
      background: var(--card);
      border-radius:var(--radius);
      padding:18px;
      border:1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .form-row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:14px;}

    input[type=date], input[type=text], input[type=number], input[type=file]{
      appearance:none;
      background:#f9fafb;
      border: 1px solid var(--border);
      padding:10px 12px;
      color:#111827;
      border-radius:10px;
      min-width:120px;
      outline:none;
      transition: border-color .2s;
      font-size:14px;
    }
    input::placeholder{color:#9ca3af}
    input:focus{border-color:var(--accent-2); background:#fff;}

    button{
      background: linear-gradient(90deg,var(--accent), var(--accent-2));
      color:#fff;
      border:0;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      transition: opacity .2s;
    }
    button.secondary{background:#f3f4f6; color:#374151; border:1px solid var(--border);}
    button:hover{opacity:0.9}

    #expenseTable{width:100%; border-collapse:collapse; margin-top:6px; overflow:hidden; border-radius:12px; background:#fff;}
    #expenseTable thead th{padding:12px 10px; font-weight:600; font-size:13px; color:#111827; background:#f3f4f6; border-bottom:2px solid var(--border);}
    #expenseTable tbody td{padding:10px; text-align:center; font-size:14px; border-bottom:1px solid #f3f4f6; color:#374151; vertical-align:middle;}
    #expenseTable tbody tr:last-child td{border-bottom:0}
    .rowTotal{font-weight:700; color:var(--accent-2)}
    #expenseTable input{min-width:80px; padding:8px 8px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:6px;}
    tfoot th{padding:12px; text-align:center; background:#f9fafb;}
    #hdfcTotal{color:var(--accent)}
    #sbiTotal{color:var(--accent-2)}
    #privateTotal{color:var(--accent-3)}
    #grandTotal{color:#111827; font-weight:700}

    .chart-row{display:flex; gap:18px; margin-top:14px; align-items:stretch; justify-content:space-between; flex-wrap:wrap;}
    .chart-card{flex:1 1 300px; min-width:260px; max-width:380px; background:#fff; padding:12px; border-radius:12px; border:1px solid var(--border); display:flex; flex-direction:column; gap:8px; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(0,0,0,0.04)}
    .chart-card canvas{width:100% !important; height:240px !important}

    .day-group-0{background:#ecfdf5}
    .day-group-1{background:#eff6ff}
    .day-group-2{background:#fefce8}
    .day-group-3{background:#fdf2f8}
    .day-group-4{background:#faf5ff}

    @media (max-width:980px){.chart-card{max-width:100%;}.form-row{justify-content:center}tfoot th{font-size:13px}}
    .controls{display:flex; gap:10px; align-items:center; justify-content:center; margin:12px 0}
    .top-actions{display:flex; gap:12px; align-items:center}

    td button{padding:6px 10px; border-radius:6px; background:#fee2e2; color:#b91c1c; border:1px solid #fecaca;}
    td button:hover{background:#fecaca}

    @keyframes rowIn{from{opacity:0; transform:translateY(-6px)} to{opacity:1; transform:none}}
    #expenseTable tbody tr{animation:rowIn .22s ease}

    @media (max-width:600px){body{padding:14px}.form-row input{min-width:110px}h2{font-size:16px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h2>Daily Expense Tracker</h2>
        <div class="subtle">Light • Clean • Responsive</div>
      </div>
      <div class="top-actions">
        <div class="subtle">Total</div>
        <div class="card" style="padding:8px 12px; display:flex; gap:8px; align-items:center">
          <div style="font-weight:700; color:var(--accent-2)" id="grandTotalHeader">0</div>
        </div>
      </div>
    </header>

    <div class="card">
      <div class="form-row">
        <input type="date" id="dateInput">
        <input type="text" id="accountInput" placeholder="Name">
        <input type="number" id="hdfcInput" placeholder="HDFC">
        <input type="number" id="sbiInput" placeholder="SBI">
        <input type="number" id="privateInput" placeholder="Account">
        <button onclick="addExpense()">Add Expense</button>
      </div>

      <div class="controls">
        <button onclick="exportData()">Export CSV</button>
        <button class="secondary" onclick="resetData()">Reset Data</button>
        <input type="file" id="fileInput" accept=".csv" onchange="importData(event)">
      </div>

      <div style="overflow:auto; margin-top:6px">
        <table id="expenseTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Name of Expense</th>
              <th>HDFC</th>
              <th>SBI</th>
              <th>Account</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <th colspan="2">Grand Total</th>
              <th id="hdfcTotal">0</th>
              <th id="sbiTotal">0</th>
              <th id="privateTotal">0</th>
              <th id="grandTotal">0</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <h3 style="color:#111827; margin:18px 0 8px; font-weight:700">Budget Dashboard</h3>
    <div class="chart-row">
      <div class="chart-card card">
        <div style="font-weight:600; color:#374151">Distribution</div>
        <canvas id="pieChart"></canvas>
      </div>
      <div class="chart-card card">
        <div style="font-weight:600; color:#374151">Breakdown</div>
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-card card">
        <div style="font-weight:600; color:#374151">Trend</div>
        <canvas id="lineChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    const tableBody = document.querySelector("#expenseTable tbody");

    function addExpense() {
      const date = document.getElementById("dateInput").value;
      const account = document.getElementById("accountInput").value;
      const hdfc = document.getElementById("hdfcInput").value || 0;
      const sbi = document.getElementById("sbiInput").value || 0;
      const privateAcc = document.getElementById("privateInput").value || 0;
      if (!date || !account) {alert("Please enter Date and Account"); return;}
      addRow(date, account, hdfc, sbi, privateAcc);
      document.getElementById("accountInput").value = "";
      document.getElementById("hdfcInput").value = "";
      document.getElementById("sbiInput").value = "";
      document.getElementById("privateInput").value = "";
    }

    function addRow(date, account, hdfc, sbi, privateAcc) {
      const row = tableBody.insertRow();
      row.innerHTML = `
        <td><input type="date" value="${date}"></td>
        <td><input type="text" value="${account}"></td>
        <td><input type="number" value="${hdfc}" oninput="updateTotals()"></td>
        <td><input type="number" value="${sbi}" oninput="updateTotals()"></td>
        <td><input type="number" value="${privateAcc}" oninput="updateTotals()"></td>
        <td class="rowTotal">0</td>
        <td><button onclick="deleteRow(this)">Delete</button></td>
      `;
      // also make date/account changes trigger save and color update
      row.cells[0].children[0].addEventListener('change', () => { updateTotals(); });
      row.cells[1].children[0].addEventListener('input', () => { saveData(); });
      updateTotals();
      saveData();
    }

    function deleteRow(btn) {btn.closest("tr").remove(); updateTotals(); saveData();}

    function updateTotals() {
      let hdfcSum=0,sbiSum=0,privateSum=0,grandSum=0;
      document.querySelectorAll("#expenseTable tbody tr").forEach(row => {
        const hdfc=parseFloat(row.cells[2].children[0].value)||0;
        const sbi=parseFloat(row.cells[3].children[0].value)||0;
        const privateAcc=parseFloat(row.cells[4].children[0].value)||0;
        const rowTotal=hdfc+sbi+privateAcc;
        row.querySelector(".rowTotal").innerText=rowTotal.toFixed(2);
        hdfcSum+=hdfc; sbiSum+=sbi; privateSum+=privateAcc; grandSum+=rowTotal;
      });
      document.getElementById("hdfcTotal").innerText=hdfcSum.toFixed(2);
      document.getElementById("sbiTotal").innerText=sbiSum.toFixed(2);
      document.getElementById("privateTotal").innerText=privateSum.toFixed(2);
      document.getElementById("grandTotal").innerText=grandSum.toFixed(2);
      document.getElementById("grandTotalHeader").innerText=grandSum.toFixed(2);
      saveData(); updateCharts(hdfcSum,sbiSum,privateSum); applyDayColors();
    }

    function applyDayColors(){let lastDate="",colorIndex=-1;document.querySelectorAll("#expenseTable tbody tr").forEach(row=>{const date=row.cells[0].children[0].value;if(date!==lastDate){colorIndex=(colorIndex+1)%5;lastDate=date;}row.className="day-group-"+colorIndex;});}

    function saveData(){const rows=[];document.querySelectorAll("#expenseTable tbody tr").forEach(row=>{rows.push({date:row.cells[0].children[0].value,account:row.cells[1].children[0].value,hdfc:row.cells[2].children[0].value,sbi:row.cells[3].children[0].value,privateAcc:row.cells[4].children[0].value});});localStorage.setItem("expenses",JSON.stringify(rows));}

    function loadData(){const data=JSON.parse(localStorage.getItem("expenses")||"[]");tableBody.innerHTML = ""; data.forEach(r=>addRow(r.date,r.account,r.hdfc,r.sbi,r.privateAcc)); updateTotals();}

    function exportData(){
      const fileName=prompt("Enter file name to save:","expenses");
      if(!fileName) return;
      const rows=[["Date","Account","HDFC","SBI","Private"]];
      document.querySelectorAll("#expenseTable tbody tr").forEach(row=>{
        rows.push([
          row.cells[0].children[0].value,
          '"'+row.cells[1].children[0].value.replace(/"/g,'""')+'"',
          row.cells[2].children[0].value,
          row.cells[3].children[0].value,
          row.cells[4].children[0].value
        ]);
      });
      const csv=rows.map(r=>r.join(",")).join("\n");
      const blob=new Blob([csv],{type:"text/csv"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url;
      a.download=fileName+".csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importData(event){
      const file=event.target.files[0];
      if(!file) return;
      const reader=new FileReader();
      reader.onload=function(e){
        const lines=e.target.result.split("\n").slice(1);
        tableBody.innerHTML="";
        lines.forEach(line=>{
          if(line.trim()==="") return;
          const parts=[];
          let current="",insideQuotes=false;
          for(let i=0;i<line.length;i++){
            const char=line[i];
            if(char==='"'){
              if(insideQuotes && line[i+1]==='"'){current+='"';i++;}
              else insideQuotes=!insideQuotes;
            }else if(char==="," && !insideQuotes){parts.push(current);current="";}
            else{current+=char;}
          }
          parts.push(current);
          const [date,account,hdfc,sbi,privateAcc]=parts.map(p=>p?.replace(/^"|"$/g,'') ?? "");
          addRow(date,account,hdfc,sbi,privateAcc);
        });
        updateTotals();
      };
      reader.readAsText(file);
    }

    function resetData(){if(confirm("Are you sure you want to reset all data?")){tableBody.innerHTML="";localStorage.removeItem("expenses");updateTotals();}}

    let pieChart,barChart,lineChart;
    function updateCharts(hdfc,sbi,privateAcc){
      const style = getComputedStyle(document.documentElement);
      const col1 = style.getPropertyValue('--accent').trim() || '#22c55e';
      const col2 = style.getPropertyValue('--accent-2').trim() || '#3b82f6';
      const col3 = style.getPropertyValue('--accent-3').trim() || '#f59e0b';

      const pieCtx = document.getElementById('pieChart').getContext('2d');
      const barCtx = document.getElementById('barChart').getContext('2d');
      const lineCtx = document.getElementById('lineChart').getContext('2d');

      // Destroy previous charts if present
      if(pieChart) { try{ pieChart.destroy(); } catch(e){} }
      if(barChart) { try{ barChart.destroy(); } catch(e){} }
      if(lineChart) { try{ lineChart.destroy(); } catch(e){} }

      // Pie (distribution)
      pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: ['HDFC','SBI','Private'],
          datasets: [{
            data: [hdfc, sbi, privateAcc],
            backgroundColor: [col1, col2, col3],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          plugins: {legend:{position:'bottom'}}
        }
      });

      // Bar (breakdown) — simple aggregated bars
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: ['HDFC','SBI','Private'],
          datasets: [{
            label: 'Amount',
            data: [hdfc, sbi, privateAcc],
            backgroundColor: [col1, col2, col3],
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {legend:{display:false}},
          scales: {
            y: {beginAtZero:true}
          }
        }
      });

      // Line (trend) — compute totals per date from table rows
      const dateMap = {};
      document.querySelectorAll("#expenseTable tbody tr").forEach(row => {
        const date = row.cells[0].children[0].value || "";
        const h = parseFloat(row.cells[2].children[0].value) || 0;
        const s = parseFloat(row.cells[3].children[0].value) || 0;
        const p = parseFloat(row.cells[4].children[0].value) || 0;
        const total = h + s + p;
        if(!date) return;
        if(!dateMap[date]) dateMap[date] = 0;
        dateMap[date] += total;
      });

      const dates = Object.keys(dateMap).sort((a,b)=>a.localeCompare(b)); // YYYY-MM-DD sorts naturally
      const totals = dates.map(d => parseFloat(dateMap[d].toFixed(2)));

      lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Daily Total',
            data: totals,
            fill: true,
            tension: 0.3,
            borderColor: col2,
            backgroundColor: hexToRgba(col2, 0.12),
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {legend:{display:false}},
          scales: {
            x: {ticks:{autoSkip:true,maxRotation:0}},
            y: {beginAtZero:true}
          }
        }
      });
    }

    // small helper to convert hex to rgba
    function hexToRgba(hex, alpha){
      try{
        hex = hex.replace('#','').trim();
        if(hex.length === 3) hex = hex.split('').map(h=>h+h).join('');
        const r = parseInt(hex.substring(0,2),16);
        const g = parseInt(hex.substring(2,4),16);
        const b = parseInt(hex.substring(4,6),16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }catch(e){
        return `rgba(59,130,246,${alpha})`;
      }
    }

    // Initialize on load
    window.addEventListener('DOMContentLoaded', () => {
      loadData();
      // If there are no rows, render empty charts
      const h = parseFloat(document.getElementById("hdfcTotal").innerText) || 0;
      const s = parseFloat(document.getElementById("sbiTotal").innerText) || 0;
      const p = parseFloat(document.getElementById("privateTotal").innerText) || 0;
      updateCharts(h,s,p);
    });
  </script>
</body>
</html>
